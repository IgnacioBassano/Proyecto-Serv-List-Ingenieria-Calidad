<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#d97706" />
  <title>Serv-list ¬∑ Crear cuenta</title>

  <!-- üß© Aplicar modo oscuro antes del CSS -->
  <script>
    (function() {
      try {
        const theme = localStorage.getItem("theme");
        if (theme === "dark") document.documentElement.classList.add("dark");
      } catch (e) {}
    })();
  </script>

  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&display=swap" rel="stylesheet">
</head>

<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="index.html">Serv-list</a>
      <nav class="nav"><!-- generado din√°micamente por nav.js --></nav>
    </div>
  </header>

  <main class="container">
    <h1 class="titulo-centrado">Crear cuenta</h1>

    <form class="formChico" id="registroForm">
      <label>
        <span>Nombre</span>
        <input type="text" name="nombre" placeholder="Nombre" required />
      </label>

      <label>
        <span>Apellido</span>
        <input type="text" name="apellido" placeholder="Apellido" required />
      </label>

      <label>
        <span>Correo electr√≥nico</span>
        <input type="email" name="email" placeholder="usuario@example.com" required />
      </label>

      <label>
       <span>Contrase√±a</span>
       <input type="password" name="password" id="password" placeholder="Contrase√±a" required />
       <div id="password-strength">
         <div id="strength-bar"></div>
         <small id="strength-text">Ingresa una contrase√±a</small>
       </div>
     </label>

      <button class="btn" type="submit">Registrarme</button>
    </form>

    <p class="muted centrado">
      ¬øYa tienes una cuenta?
      <a href="iniciar-sesion.html" class="link-crear">Iniciar sesi√≥n</a>
    </p>

    <p id="msg" class="centrado"></p>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p class="muted">¬© 2025 Serv-list ¬∑ Proyecto de Ingenier√≠a y Calidad de Software</p>
    </div>
  </footer>

  <script src="scripts/nav.js"></script>
  <script src="scripts/theme.js"></script>

  <!-- üß† Registro con validaci√≥n visual -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("registroForm");
      const msg = document.getElementById("msg");

      // Crear lista de requisitos
      const passwordInput = form.querySelector('input[name="password"]');
      const container = passwordInput.parentElement;
      const requisitos = document.createElement("ul");
      requisitos.id = "password-requisitos";
      requisitos.innerHTML = `
        <li id="req-length" class="invalid">M√≠nimo 6 caracteres</li>
        <li id="req-mayus" class="invalid">Al menos una may√∫scula</li>
        <li id="req-minus" class="invalid">Al menos una min√∫scula</li>
        <li id="req-num" class="invalid">Al menos un n√∫mero</li>
      `;
      container.appendChild(requisitos);

      // Campo de confirmaci√≥n
      const confirmLabel = document.createElement("label");
      confirmLabel.innerHTML = `
        <span>Confirmar contrase√±a</span>
        <input type="password" name="confirmPassword" placeholder="Repite la contrase√±a" required />
      `;
      form.insertBefore(confirmLabel, form.querySelector("button.btn"));

      const confirmInput = confirmLabel.querySelector("input");
      const reqs = {
        length: document.getElementById("req-length"),
        mayus: document.getElementById("req-mayus"),
        minus: document.getElementById("req-minus"),
        num: document.getElementById("req-num"),
      };

      passwordInput.addEventListener("input", () => {
        const val = passwordInput.value;
        reqs.length.className = val.length >= 6 ? "valid" : "invalid";
        reqs.mayus.className = /[A-Z]/.test(val) ? "valid" : "invalid";
        reqs.minus.className = /[a-z]/.test(val) ? "valid" : "invalid";
        reqs.num.className = /\d/.test(val) ? "valid" : "invalid";
      });

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        msg.textContent = "";
        msg.style.color = "";

        const data = Object.fromEntries(new FormData(form));
        const { password, confirmPassword } = data;

        // Validaci√≥n b√°sica antes de enviar
        if (password.length < 6 || !/[A-Z]/.test(password) || !/[a-z]/.test(password) || !/\d/.test(password)) {
          msg.textContent = "‚ö†Ô∏è La contrase√±a no cumple los requisitos.";
          msg.style.color = "red";
          return;
        }

        if (password !== confirmPassword) {
          msg.textContent = "‚ö†Ô∏è Las contrase√±as no coinciden.";
          msg.style.color = "red";
          return;
        }

        msg.textContent = "Enviando...";
        msg.style.color = "gray";

        try {
          const res = await fetch("/api/usuarios/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });

          const json = await res.json();
          if (res.ok) {
            msg.textContent = "‚úÖ Registro exitoso. Ahora puedes iniciar sesi√≥n.";
            msg.style.color = "green";
            form.reset();
            setTimeout(() => (window.location.href = "iniciar-sesion.html"), 1500);
          } else {
            msg.textContent = "‚ö†Ô∏è " + (json.error || "Error en el registro");
            msg.style.color = "red";
          }
        } catch {
          msg.textContent = "‚ùå Error al conectar con el servidor.";
          msg.style.color = "red";
        }
      });
    });
  </script>

  <script>
  // ============================
  // üîí Medidor de fortaleza de contrase√±a
  // ============================
  const passwordInput = document.getElementById("password");
  const strengthBar = document.getElementById("strength-bar");
  const strengthText = document.getElementById("strength-text");

  passwordInput.addEventListener("input", () => {
    const value = passwordInput.value;
    let strength = 0;

    // Criterios b√°sicos
    if (value.length >= 6) strength++;
    if (/[A-Z]/.test(value)) strength++;
    if (/[a-z]/.test(value)) strength++;
    if (/\d/.test(value)) strength++;
    if (/[^A-Za-z0-9]/.test(value)) strength++;

    // Evaluar fuerza
    let color = "#d1d5db"; // gris neutro
    let text = "Ingresa una contrase√±a";

    switch (strength) {
      case 0:
      case 1:
        color = "#dc2626"; // rojo
        text = "Muy d√©bil";
        break;
      case 2:
        color = "#f97316"; // naranja
        text = "D√©bil";
        break;
      case 3:
        color = "#eab308"; // amarillo
        text = "Regular";
        break;
      case 4:
        color = "#22c55e"; // verde medio
        text = "Fuerte";
        break;
      case 5:
        color = "#16a34a"; // verde oscuro
        text = "Muy fuerte";
        break;
    }

    strengthBar.style.width = (strength * 20) + "%";
    strengthBar.style.backgroundColor = color;
    strengthText.textContent = text;
  });
</script>

</body>
</html>